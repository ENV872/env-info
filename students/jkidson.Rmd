---
title: "R Markdown Assignment, Week 2"
author: "Jennifer Kidson"
date: "January 15, 2016"
output:
  html_document:
    toc: true
    toc_depth: 2
---

## Content
        
For this class, the group will be working to create a program to take in survey data in real time, reorganize it, and output summary statistics. For my group project (on Santa Barbara water supply) and future work, I'm most interested in learning data management strategies and ways to visualize data. 
        
## Techniques
        
1. Wrangling data
2. Cleaning up data
3. Visualizing data
    + **interactive maps**
    + *interactive time series*
        
## Data
        
A group member has data on survey responses on solid waste. Data is received via text message and associated timestamps. The responses need to be tied to a specific survey question and organized.
  
## Image
![](images/jkidson_age_hist.png)

<!--- hist(ugandasms$age, main="Age Distribution of Survey Respondents", xlab="Age (Years)", xlim=c(0, 80))-->

Fig. 1. Histogram of age distribution of survey respondents.

## Summary of Survey Response Data

```{r}
# read csv
d = read.csv('data/jkidson_ugandasms.csv')
      
# output summary
summary(d)
```

### [Citizen Monitoring Github Page](https://github.com/citizen-monitoring)

## Data Wrangling

### Reading CSV with readr
```{r} 
library(readr)

d = read_csv('data/jkidson_ugandasms.csv')
head(d)
summary(d)
```

### dplyr Demo

#### Pseudocode
```{r}
# read in csv
# view data
# limit columns to Zone and satis
# limit rows to just zone "CORNER"
# get count for each satisfaction level
# write out csv
```

#### Multiple Variables
```{r}
# read in csv
surveys = read.csv('data/jkidson_ugandasms.csv') 

# view data
head(surveys)
summary(surveys)

# limit columns to species and year
surveys_2 = surveys[,c('Zone', 'satis')]

# limit rows to just species "NL"
surveys_3 = surveys_2[surveys_2$Zone  == 'CORNER',]

# get count per year
surveys_4 = aggregate(Zone ~ satis, data=surveys_3, FUN='length')

# write to csv
write.csv(surveys_4, 'data/surveys_jkidson.csv', row.names = FALSE)
```

#### Nested Functions 

(For some reason this nested function is giving me an error, so I commented it out for now. I'll come back to it if I have time after the group assignment.)
```{r}
# read in data
surveys = read.csv('data/jkidson_ugandasms.csv') 

# view data
head(surveys)
summary(surveys)

# limit data with [], aggregate to count, write to csv
# write.csv(
#  aggregate(
#    Zone ~ satis, 
#    data = surveys[surveys$satis  == 'CORNER', c('Zone', 'satis')], 
#    FUN = 'length'), 
#  'data/surveys_jkidson.csv',
#  row.names = FALSE)
```

#### Using dplyr
```{r}
# load libraries
library(readr)
library(dplyr)
```

```{r}
# read in csv
surveys = read_csv('data/jkidson_ugandasms.csv') 

# dplyr elegance
surveys %T>%                            # note tee operator %T>% for glimpse
  glimpse() %>%                         # view data
  select(Zone, satis) %>%               # limit columns
  filter(Zone  == 'CORNER') %>%         # limit rows
  group_by(satis) %>%                   # get count by first grouping
  summarize(n = n()) %>%                # then summarize
  write_csv('data/surveys_jkidson.csv') # write out csv
```