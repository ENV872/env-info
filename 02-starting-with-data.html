<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Data Carpentry contributors" />


<title>Starting with data</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/readable.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/octicons/3.3.0/octicons.css" type="text/css" />
<link rel="stylesheet" href="styles/styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top navbar-transparent">
  <div class="container">
    <div class="navbar-header">
      <!--<a href="./" class="navbar-brand"><img src="img/Bren-logo_height50.png">env-info</a>-->
      <a href="./" class="navbar-brand"><i class="fa fa-home"></i> env-info</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li>
          <a href="./schedule.html"><i class="fa fa-calendar"></i> schedule</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="./students.html"><i class="fa fa-users"></i> students</a></li>
      </ul>
    </div>
  </div>
</div>

<div id="header">
<h1 class="title">Starting with data</h1>
<h4 class="author"><em>Data Carpentry contributors</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#presentation-of-the-survey-data">Presentation of the Survey Data</a><ul>
<li><a href="#challenge">Challenge</a></li>
<li><a href="#factors">Factors</a><ul>
<li><a href="#converting-factors">Converting factors</a></li>
<li><a href="#challenge-1">Challenge</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<hr />
<blockquote>
<h2>Learning Objectives</h2>
<ul>
<li>load external data (CSV files) in memory using the survey table (<code>surveys.csv</code>) as an example</li>
<li>explore the structure and the content of the data in R</li>
<li>understand what are factors and how to manipulate them</li>
</ul>
</blockquote>
<hr />
<div id="presentation-of-the-survey-data" class="section level1">
<h1>Presentation of the Survey Data</h1>
<p>We are studying the species and weight of animals caught in plots in our study area. The dataset is stored as a <code>csv</code> file: each row holds information for a single animal, and the columns represent:</p>
<table>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">record_id</td>
<td align="left">Unique id for the observation</td>
</tr>
<tr class="even">
<td align="left">month</td>
<td align="left">month of observation</td>
</tr>
<tr class="odd">
<td align="left">day</td>
<td align="left">day of observation</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="left">year of observation</td>
</tr>
<tr class="odd">
<td align="left">plot_id</td>
<td align="left">ID of a particular plot</td>
</tr>
<tr class="even">
<td align="left">species_id</td>
<td align="left">2-letter code</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="left">sex of animal (“M”, “F”)</td>
</tr>
<tr class="even">
<td align="left">hindfoot_length</td>
<td align="left">length of the hindfoot in mm</td>
</tr>
<tr class="odd">
<td align="left">weight</td>
<td align="left">weight of the animal in grams</td>
</tr>
<tr class="even">
<td align="left">genus</td>
<td align="left">genus of animal</td>
</tr>
<tr class="odd">
<td align="left">species</td>
<td align="left">species of animal</td>
</tr>
<tr class="even">
<td align="left">taxa</td>
<td align="left">e.g. Rodent, Reptile, Bird, Rabbit</td>
</tr>
<tr class="odd">
<td align="left">plot_type</td>
<td align="left">type of plot</td>
</tr>
</tbody>
</table>
<p>We are going to use the R function <code>download.file()</code> to download the CSV file that contains the survey data from figshare, and we will use <code>read.csv()</code> to load into memory (as a <code>data.frame</code>) the content of the CSV file.</p>
<p>To download the data into the <code>data/</code> subdirectory, do:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">download.file</span>(<span class="st">&quot;http://files.figshare.com/2236372/combined.csv&quot;</span>,
              <span class="st">&quot;data/portal_data_joined.csv&quot;</span>)</code></pre>
<p>You are now ready to load the data:</p>
<pre class="sourceCode r"><code class="sourceCode r">surveys &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/portal_data_joined.csv&#39;</span>)</code></pre>
<p>This statement doesn’t produce any output because assignment doesn’t display anything. If we want to check that our data has been loaded, we can print the variable’s value: <code>surveys</code></p>
<p>Alternatively, wrapping an assignment in parentheses will perform the assignment and display it at the same time.</p>
<pre class="sourceCode r"><code class="sourceCode r">(surveys &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/portal_data_joined.csv&#39;</span>))</code></pre>
<p>Wow… that was a lot of output. At least it means the data loaded properly. Let’s check the top (the first 6 lines) of this <code>data.frame</code> using the function <code>head()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(surveys)</code></pre>
<pre><code>#&gt;   record_id month day year plot_id species_id sex hindfoot_length weight
#&gt; 1         1     7  16 1977       2         NL   M              32     NA
#&gt; 2        72     8  19 1977       2         NL   M              31     NA
#&gt; 3       224     9  13 1977       2         NL                  NA     NA
#&gt; 4       266    10  16 1977       2         NL                  NA     NA
#&gt; 5       349    11  12 1977       2         NL                  NA     NA
#&gt; 6       363    11  12 1977       2         NL                  NA     NA
#&gt;     genus  species   taxa plot_type
#&gt; 1 Neotoma albigula Rodent   Control
#&gt; 2 Neotoma albigula Rodent   Control
#&gt; 3 Neotoma albigula Rodent   Control
#&gt; 4 Neotoma albigula Rodent   Control
#&gt; 5 Neotoma albigula Rodent   Control
#&gt; 6 Neotoma albigula Rodent   Control</code></pre>
<p>An important feature of a <code>data.frame</code>is that each column is a vector, with the same type of data. We can see this when inspecting the __str__ucture of a <code>data.frame</code> with the function <code>str()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(surveys)</code></pre>
<div id="challenge" class="section level3">
<h3>Challenge</h3>
<p>Based on the output of <code>str(surveys)</code>, can you answer the following questions?</p>
<ul>
<li>What is the class of the object <code>surveys</code>?</li>
<li>How many rows and how many columns are in this object?</li>
<li>How many species have been recorded during these surveys?</li>
</ul>
<p>As you can see, many of the columns consist of integers, however, the columns <code>species</code> and <code>sex</code> are of a special class called a <code>factor</code>. Before we learn more about the <code>data.frame</code> class, we are going to talk about factors. They are very useful but not necessarily intuitive, and therefore require some attention.</p>
</div>
<div id="factors" class="section level2">
<h2>Factors</h2>
<p>Factors are used to represent categorical data. Factors can be ordered or unordered and are an important class for statistical analysis and for plotting.</p>
<p>Factors are stored as integers, and have labels associated with these unique integers. While factors look (and often behave) like character vectors, they are actually integers under the hood, and you need to be careful when treating them like strings.</p>
<p>Once created, factors can only contain a pre-defined set values, known as <em>levels</em>. By default, R always sorts <em>levels</em> in alphabetical order. For instance, if you have a factor with 2 levels:</p>
<pre class="sourceCode r"><code class="sourceCode r">sex &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>))</code></pre>
<p>R will assign <code>1</code> to the level <code>&quot;female&quot;</code> and <code>2</code> to the level <code>&quot;male&quot;</code> (because <code>f</code> comes before <code>m</code>, even though the first element in this vector is <code>&quot;male&quot;</code>). You can check this by using the function <code>levels()</code>, and check the number of levels using <code>nlevels()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(sex)
<span class="kw">nlevels</span>(sex)</code></pre>
<p>Sometimes, the order of the factors does not matter, other times you might want to specify the order because it is meaningful (e.g., “low”, “medium”, “high”) or it is required by particular type of analysis. Additionally, specifying the order of the levels allows us to compare levels:</p>
<pre class="sourceCode r"><code class="sourceCode r">food &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>))
<span class="kw">levels</span>(food)
food &lt;-<span class="st"> </span><span class="kw">factor</span>(food, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>))
<span class="kw">levels</span>(food)
<span class="kw">min</span>(food) ## doesn&#39;t work</code></pre>
<pre><code>#&gt; Error in Summary.factor(structure(c(1L, 3L, 2L, 3L, 1L, 2L, 3L), .Label = c(&quot;low&quot;, : &#39;min&#39; not meaningful for factors</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">food &lt;-<span class="st"> </span><span class="kw">factor</span>(food, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>)
<span class="kw">levels</span>(food)
<span class="kw">min</span>(food) ## works!</code></pre>
<p>In R’s memory, these factors are represented by numbers (1, 2, 3). They are better than using simple integer labels because factors are self describing: <code>&quot;low&quot;</code>, <code>&quot;medium&quot;</code>, <code>&quot;high&quot;</code>&quot; is more descriptive than <code>1</code>, <code>2</code>, <code>3</code>. Which is low? You wouldn’t be able to tell with just integer data. Factors have this information built in. It is particularly helpful when there are many levels (like the species in our example data set).</p>
<div id="converting-factors" class="section level3">
<h3>Converting factors</h3>
<p>If you need to convert a factor to a character vector, simply use <code>as.character(x)</code>.</p>
<p>Converting a factors where the levels appear as numbers (such as in concentration levels) to a numeric vector is however a little trickier, and you have to go via a character vector. Compare:</p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">2</span>))
<span class="kw">as.numeric</span>(f)               ## wrong! and there is no warning...
<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(f)) ## works...
<span class="kw">as.numeric</span>(<span class="kw">levels</span>(f))[f]    ## The recommended way.</code></pre>
<p>Notice that in this last approach, three important steps have happened<br />* We have obtained the factor levels using <code>levels(f)</code><br />* We have converted these levels to numeric values using <code>as.numeric(levels(f))</code><br />* We have then accessed these numeric values using the underlying integers of the vector <code>f</code> inside the square brackets</p>
</div>
<div id="challenge-1" class="section level3">
<h3>Challenge</h3>
<p>The function <code>table()</code> tabulates observations and can be used to create bar plots quickly. For instance:</p>
<pre class="sourceCode r"><code class="sourceCode r">exprmt &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;treat1&quot;</span>, <span class="st">&quot;treat2&quot;</span>, <span class="st">&quot;treat1&quot;</span>, <span class="st">&quot;treat3&quot;</span>, <span class="st">&quot;treat1&quot;</span>, <span class="st">&quot;control&quot;</span>,
                   <span class="st">&quot;treat1&quot;</span>, <span class="st">&quot;treat2&quot;</span>, <span class="st">&quot;treat3&quot;</span>))
<span class="kw">table</span>(exprmt)</code></pre>
<pre><code>#&gt; exprmt
#&gt; control  treat1  treat2  treat3 
#&gt;       1       4       2       2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">table</span>(exprmt))</code></pre>
<p><img src="img/Rmd_wrong-order-1.png" title="" alt="" width="672" /> gives you a barplot of the number of observations.</p>
<p>How can you recreate this plot with “control” listed last instead of first?</p>
<!---

```r
exprmt <- factor(exprmt, levels=c("treat1", "treat2", "treat3", "control"))
barplot(table(exprmt))
```

<img src="img/Rmd_correct-order-1.png" title="" alt="" width="672" />
--->
</div>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
